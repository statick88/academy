---
// src/pages/courses/[slug].astro
import CourseLayout from '../../layouts/CourseLayout.astro';
import Card, { CardHeader, CardContent } from '../../components/Card.tsx';
import Badge from '../../components/Badge.tsx';
import Button from '../../components/Button.tsx';
import { getCourseBySlug } from '../../lib/data/courses';

export async function getStaticPaths() {
	const { courses } = await import('../../lib/data/courses');
	return courses.map(course => ({
		params: { slug: course.slug },
		props: { course }
	}));
}

const { course } = Astro.props;
---

<CourseLayout
	title={`${course.title} - Statick Academy`}
	description={course.description}
	courseTitle={course.title}
	showBackButton={true}
>
	<div class="grid lg:grid-cols-3 gap-8">
		<!-- Main Content -->
		<div class="lg:col-span-2">
			<!-- Course Header -->
			<div class="mb-8">
				<div class="flex items-center space-x-2 mb-4">
					<Badge variant={course.level === 'beginner' ? 'success' :
									course.level === 'intermediate' ? 'warning' : 'error'}
						   client:load>
						{course.level === 'beginner' ? 'Principiante' :
						 course.level === 'intermediate' ? 'Intermedio' : 'Avanzado'}
					</Badge>
					{course.price === 'free' && <Badge variant="success" client:load>Gratuito</Badge>}
					{course.price === 'premium' && <Badge variant="secondary" client:load>Premium</Badge>}
					<Badge variant={course.status === 'available' ? 'success' :
									course.status === 'coming-soon' ? 'warning' : 'info'}
						   client:load>
						{course.status === 'available' ? 'Disponible' :
						 course.status === 'coming-soon' ? 'Pr贸ximamente' : 'En Desarrollo'}
					</Badge>
				</div>

				<p class="text-academy-text-secondary text-lg leading-relaxed mb-6">
					{course.longDescription}
				</p>

				<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
					<div class="text-center p-4 bg-academy-bg-primary rounded-lg border border-academy-border-light">
						<div class="text-2xl font-bold text-primary-600">{course.modules}</div>
						<div class="text-academy-text-secondary text-sm">M贸dulos</div>
					</div>
					<div class="text-center p-4 bg-academy-bg-primary rounded-lg border border-academy-border-light">
						<div class="text-2xl font-bold text-secondary-600">{course.lessons}</div>
						<div class="text-academy-text-secondary text-sm">Lecciones</div>
					</div>
					<div class="text-center p-4 bg-academy-bg-primary rounded-lg border border-academy-border-light">
						<div class="text-2xl font-bold text-success">{course.labs}</div>
						<div class="text-academy-text-secondary text-sm">Laboratorios</div>
					</div>
					<div class="text-center p-4 bg-academy-bg-primary rounded-lg border border-academy-border-light">
						<div class="text-2xl font-bold text-info">{course.duration}</div>
						<div class="text-academy-text-secondary text-sm">Duraci贸n</div>
					</div>
				</div>

				<div class="flex flex-wrap gap-2 mb-6">
					{course.tags.map(tag => (
						<Badge variant="outline" key={tag} client:load>{tag}</Badge>
					))}
				</div>
			</div>

			<!-- Prerequisites -->
			{course.prerequisites && course.prerequisites.length > 0 && (
				<Card variant="default" className="mb-8">
					<CardHeader>
						<h3 class="text-lg font-semibold text-academy-text-primary">Prerrequisitos</h3>
					</CardHeader>
					<CardContent>
						<ul class="space-y-2">
							{course.prerequisites.map(prereq => (
								<li class="flex items-start" key={prereq}>
									<svg class="w-5 h-5 text-success mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
									</svg>
									<span class="text-academy-text-secondary">{prereq}</span>
								</li>
							))}
						</ul>
					</CardContent>
				</Card>
			)}

			<!-- Learning Outcomes -->
			<Card variant="default" className="mb-8">
				<CardHeader>
					<h3 class="text-lg font-semibold text-academy-text-primary">驴Qu茅 Aprender谩s?</h3>
				</CardHeader>
				<CardContent>
					<ul class="space-y-3">
						{course.learningOutcomes.map(outcome => (
							<li class="flex items-start" key={outcome}>
								<svg class="w-5 h-5 text-primary-600 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
								</svg>
								<span class="text-academy-text-secondary">{outcome}</span>
							</li>
						))}
					</ul>
				</CardContent>
			</Card>

			<!-- Syllabus -->
			{course.syllabus.length > 0 && (
				<Card variant="default" className="mb-8">
					<CardHeader>
						<h3 class="text-lg font-semibold text-academy-text-primary">Programa del Curso</h3>
					</CardHeader>
					<CardContent>
						<div class="space-y-6">
							{course.syllabus.map(module => (
								<div class="border-l-4 border-primary-200 pl-4" key={module.id}>
									<div class="flex items-center justify-between mb-2">
										<h4 class="text-md font-semibold text-academy-text-primary">
											M贸dulo {module.order}: {module.title}
										</h4>
										<span class="text-sm text-academy-text-secondary">{module.duration}</span>
									</div>
									<p class="text-academy-text-secondary text-sm mb-3">{module.description}</p>
									<div class="space-y-2">
										{module.lessons.map(lesson => (
											<div class="flex items-center justify-between py-2 px-3 bg-academy-bg-primary rounded" key={lesson.id}>
												<div class="flex items-center">
													<span class={`w-2 h-2 rounded-full mr-3 ${
														lesson.type === 'video' ? 'bg-red-400' :
														lesson.type === 'text' ? 'bg-blue-400' :
														lesson.type === 'lab' ? 'bg-green-400' : 'bg-yellow-400'
													}`}></span>
													<span class="text-academy-text-primary text-sm">{lesson.title}</span>
												</div>
												<div class="flex items-center space-x-2">
													<Badge variant="outline" size="sm" client:load>
														{lesson.type === 'video' ? 'Video' :
														 lesson.type === 'text' ? 'Lectura' :
														 lesson.type === 'lab' ? 'Laboratorio' : 'Quiz'}
													</Badge>
													<span class="text-academy-text-secondary text-xs">{lesson.duration}</span>
												</div>
											</div>
										))}
									</div>
								</div>
							))}
						</div>
					</CardContent>
				</Card>
			)}
		</div>

		<!-- Sidebar -->
		<div class="lg:col-span-1">
			<!-- Course Actions -->
			<Card variant="elevated" className="mb-6 sticky top-24">
				<CardContent className="p-6">
					<div class="text-center mb-6">
						<div class="text-3xl font-bold text-primary-600 mb-1">{course.instructor}</div>
						<div class="text-academy-text-secondary text-sm">Instructor</div>
					</div>

					<Button variant="primary" size="lg" className="w-full mb-4" client:load>
						{course.status === 'available' ? 'Comenzar Curso' :
						 course.status === 'coming-soon' ? 'Reservar Mi Lugar' : 'Notificarme'}
					</Button>

					{course.status === 'coming-soon' && (
						<p class="text-academy-text-secondary text-sm text-center mb-4">
							 Recibe una notificaci贸n cuando el curso est茅 disponible
						</p>
					)}

					<div class="border-t border-academy-border-light pt-4">
						<div class="flex items-center justify-between text-sm mb-2">
							<span class="text-academy-text-secondary">Precio:</span>
							<span class={`font-semibold ${course.price === 'free' ? 'text-success' : 'text-secondary-600'}`}>
								{course.price === 'free' ? 'Gratuito' : 'Premium'}
							</span>
						</div>
						<div class="flex items-center justify-between text-sm mb-2">
							<span class="text-academy-text-secondary">Nivel:</span>
							<span class="font-semibold text-academy-text-primary">
								{course.level === 'beginner' ? 'Principiante' :
								 course.level === 'intermediate' ? 'Intermedio' : 'Avanzado'}
							</span>
						</div>
						<div class="flex items-center justify-between text-sm">
							<span class="text-academy-text-secondary">Idioma:</span>
							<span class="font-semibold text-academy-text-primary">Espa帽ol</span>
						</div>
					</div>
				</CardContent>
			</Card>

			<!-- Share Course -->
			<Card variant="default" className="mb-6">
				<CardHeader>
					<h4 class="font-semibold text-academy-text-primary">Compartir Curso</h4>
				</CardHeader>
				<CardContent>
					<div class="flex space-x-2">
						<Button variant="outline" size="sm" className="flex-1" client:load>
							<svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
								<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
							</svg>
							Twitter
						</Button>
						<Button variant="outline" size="sm" className="flex-1" client:load>
							<svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
								<path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
							</svg>
							LinkedIn
						</Button>
					</div>
				</CardContent>
			</Card>

			<!-- Course Info -->
			<Card variant="default">
				<CardHeader>
					<h4 class="font-semibold text-academy-text-primary">Informaci贸n del Curso</h4>
				</CardHeader>
				<CardContent>
					<div class="space-y-3">
						<div class="flex justify-between">
							<span class="text-academy-text-secondary">ltima actualizaci贸n:</span>
							<span class="text-academy-text-primary text-sm">2026</span>
						</div>
						<div class="flex justify-between">
							<span class="text-academy-text-secondary">Certificado:</span>
							<span class="text-academy-text-primary text-sm">S铆 incluido</span>
						</div>
						<div class="flex justify-between">
							<span class="text-academy-text-secondary">Soporte:</span>
							<span class="text-academy-text-primary text-sm">Comunidad</span>
						</div>
					</div>
				</CardContent>
			</Card>
		</div>
	</div>
</CourseLayout>